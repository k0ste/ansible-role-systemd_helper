{{ '## ' + 'resolved.conf' }}
{{ '# ' + ansible_managed }}
{{ '# ' + 'Do not edit manually' }}

{{ '[Resolve]' }}
{% for r in hostvars[inventory_hostname]['systemd_resolved'] %}
{% if r.resolved is defined and r.resolved != '' %}
{% for rr in r.resolved %}
{% if rr.dns is defined and rr.dns != '' %}
{% if rr.dns is string and rr.dns | ipaddr('host') %}
{{ 'DNS' + '=' + rr.dns }}
{% elif rr.dns is sequence %}
{% for addr in rr.dns %}
{% if addr | ipaddr('host') %}
{% if loop.first %}
{{ 'DNS' + '=' -}}
{% endif %}
{{ addr -}}
{% if not loop.last %}
{{ ' ' -}}
{% else %}
{{ '' }}
{% endif %}
{% endif %}
{% endfor %}
{% endif %}
{% endif %}
{% if rr.fallback_dns is defined and rr.fallback_dns != '' %}
{% if rr.fallback_dns is string and rr.fallback_dns | ipaddr('host') %}
{{ 'FallbackDNS' + '=' + rr.fallback_dns }}
{% elif rr.fallback_dns is sequence %}
{% for addr in rr.fallback_dns %}
{% if addr | ipaddr('host') %}
{% if loop.first %}
{{ 'FallbackDNS' + '=' -}}
{% endif %}
{{ addr -}}
{% if not loop.last %}
{{ ' ' -}}
{% endif %}
{% endif %}
{% endfor %}
{% endif %}
{% endif %}
{% if rr.domains is defined and rr.domains != '' %}
{% if rr.domains is string %}
{{ 'Domains' + '=' + rr.domains }}
{% elif rr.domains is sequence %}
{% for addr in rr.domains %}
{% if loop.first %}
{{ 'Domains' + '=' -}}
{% endif %}
{{ addr -}}
{% if not loop.last %}
{{ ' ' -}}
{% endif %}
{% endfor %}
{% endif %}
{% endif %}
{% if rr.llmnr is defined and rr.llmnr in ['true', 'false', 'resolve'] %}
{{ 'LLMNR' + '=' + rr.llmnr }}
{% endif %}
{% if rr.multicast_dns is defined and rr.multicast_dns in
      ['true', 'false', 'resolve'] %}
{{ 'MulticastDNS' + '=' + rr.multicast_dns }}
{% endif %}
{% if rr.dnssec is defined and rr.dnssec in
      ['true', 'false', 'allow-downgrade'] %}
{{ 'DNSSEC' + '=' + rr.dnssec }}
{% endif %}
{% if rr.cache is defined and rr.cache in ['true', 'false'] %}
{{ 'Cache' + '=' + rr.cache }}
{% endif %}
{% if rr.dns_stub_listener is defined and rr.dns_stub_listener in
      ['true', 'false', 'udp', 'tcp'] %}
{{ 'DNSStubListener' + '=' + rr.dns_stub_listener }}
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}
